# based on https://github.com/AFLplusplus/AFLplusplus/blob/stable/Dockerfile
FROM mutator_testing

ENV LLVM_CONFIG=llvm-config-11
ENV AFL_SKIP_CPUFREQ=1

WORKDIR /AFLplusplus

RUN git clone https://github.com/AFLplusplus/AFLplusplus --branch=2.68c && \
    cd AFLplusplus && \
    export REAL_CXX=g++-10 && export CC=gcc-10 && export AFL_USE_UBSAN=1 && \
    export CXX=g++-10 && make clean && \
    make source-only && make install && make clean

ENV IS_DOCKER="1"

WORKDIR /home/eval/

COPY tmp/lib/ ./lib/

COPY eval/start_aflppubsan.sh .
RUN chmod +x start_aflppubsan.sh
